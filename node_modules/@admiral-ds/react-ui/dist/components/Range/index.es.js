import{jsx,jsxs}from"react/jsx-runtime";import{useState,useRef,useLayoutEffect,useEffect}from"react";import{throttle}from"../common/utils/throttle.es.js";import{sortNum,calcValue,arraysEqual,calcSliderCoords}from"./utils.es.js";import{Wrapper,TrackWrapper,Track,FilledTrack,DefaultTrack,Thumb,ThumbCircle}from"./style.es.js";const Range=({minValue=0,maxValue=20,value:userValue,onChange,onRangeMouseUp,disabled=!1,step=1,dimension="m",skeleton=!1,...props})=>{const value=Array.isArray(userValue)&&2===userValue.length&&"number"==typeof userValue[0]&&"number"==typeof userValue[1]?sortNum(userValue):[minValue,maxValue],[isDraging,setDrag]=useState(!1),[isDraging2,setDrag2]=useState(!1),[animation,setAnimation]=useState(!0),[rangeWidth,setRangeWidth]=useState(0),filledRef=useRef(null),trackRef=useRef(null),sliderRef=useRef(null),slider2Ref=useRef(null);useLayoutEffect(()=>{let newValue=value;if(step&&"any"!==step){if(newValue=[Math.round(newValue[0]/step)*step,Math.round(newValue[1]/step)*step],step.toString().includes(".")){const decimal=step.toString().match(/\.(\d+)/)?.[1].length;newValue=[+newValue[0].toFixed(decimal),+newValue[1].toFixed(decimal)]}}!function(value){const slider1Coords=calcSliderCoords(value[0],minValue,maxValue,rangeWidth),slider2Coords=calcSliderCoords(value[1],minValue,maxValue,rangeWidth);sliderRef.current&&slider2Ref.current&&filledRef.current&&(sliderRef.current.style.left=`${slider1Coords}%`,slider2Ref.current.style.left=`${slider2Coords}%`,filledRef.current.style.left=`${slider1Coords}%`,filledRef.current.style.right=100-slider2Coords+"%")}(value)},[value,rangeWidth,minValue,maxValue,step]),useLayoutEffect(()=>{if(trackRef.current){const resizeObserver=new ResizeObserver(entries=>{entries.forEach(entry=>setRangeWidth(entry.contentRect.width||0))});return resizeObserver.observe(trackRef.current),()=>{resizeObserver.disconnect()}}},[setRangeWidth]);const[moveListener,freeResources]=throttle(e=>{updateSlider(e)},50);useEffect(()=>(!isDraging&&!isDraging2||disabled||(document.addEventListener("mousemove",moveListener),document.addEventListener("mouseup",handleSliderMouseUp),document.addEventListener("touchmove",moveListener),document.addEventListener("touchend",handleSliderMouseUp),document.addEventListener("touchcancel",handleSliderMouseUp)),()=>{freeResources(),document.removeEventListener("mousemove",moveListener),document.removeEventListener("mouseup",handleSliderMouseUp),document.removeEventListener("touchmove",moveListener),document.removeEventListener("touchend",handleSliderMouseUp),document.removeEventListener("touchcancel",handleSliderMouseUp)}));const updateSlider=e=>{if(setAnimation(!1),isDraging||isDraging2){const calcVal=calcValue(e,trackRef,minValue,maxValue,step);if(isDraging&&calcVal>value[1]){const newValue=[value[1],calcVal];setDrag(!1),setDrag2(!0),arraysEqual(sortNum(newValue),value)||onChange(e,sortNum(newValue))}else if(isDraging2&&calcVal<value[0]){const newValue=[calcVal,value[0]];setDrag(!0),setDrag2(!1),arraysEqual(sortNum(newValue),value)||onChange(e,sortNum(newValue))}else{const newValue=isDraging?[calcVal,value[1]]:[value[0],calcVal];arraysEqual(sortNum(newValue),value)||onChange(e,sortNum(newValue))}}},onSliderClick=(_e,slider)=>{"first"===slider?setDrag(!0):setDrag2(!0),setAnimation(!0)},handleSliderMouseUp=e=>{const calcVal=calcValue(e,trackRef,minValue,maxValue,step);if(onRangeMouseUp?.(),isDraging&&calcVal>value[1]){const newValue=[value[1],calcVal];arraysEqual(sortNum(newValue),value)||onChange(e,sortNum(newValue))}if(isDraging2&&calcVal<value[0]){const newValue=[calcVal,value[0]];arraysEqual(sortNum(newValue),value)||onChange(e,sortNum(newValue))}else{const newValue=isDraging?[calcVal,value[1]]:[value[0],calcVal];arraysEqual(sortNum(newValue),value)||onChange(e,sortNum(newValue))}setAnimation(!0),setDrag(!1),setDrag2(!1)},onTrackClick=e=>{const calcVal=calcValue(e,trackRef,minValue,maxValue,step);if(Math.abs(value[1]-calcVal)<Math.abs(calcVal-value[0]))arraysEqual(sortNum([value[0],calcVal]),value)||onChange(e,sortNum([value[0],calcVal])),onSliderClick(0,"second");else if(Math.abs(value[1]-calcVal)>Math.abs(calcVal-value[0]))arraysEqual(sortNum([calcVal,value[1]]),value)||onChange(e,sortNum([calcVal,value[1]])),onSliderClick(0,"first");else if(Math.abs(value[1]-calcVal)===Math.abs(calcVal-value[0])){const slider=value[0]===value[1]?calcVal<value[0]?"first":"second":"first",newValue="first"===slider?[calcVal,value[1]]:[value[0],calcVal];arraysEqual(sortNum(newValue),value)||onChange(e,sortNum(newValue)),onSliderClick(0,slider)}};return jsx(Wrapper,{"data-disabled":disabled,$disabled:disabled,$skeleton:skeleton,...props,children:jsx(TrackWrapper,{$dimension:dimension,$skeleton:skeleton,onTouchStart:onTrackClick,onMouseDown:onTrackClick,children:jsxs(Track,{children:[jsx(FilledTrack,{ref:filledRef,$animation:animation}),jsxs(DefaultTrack,{ref:trackRef,children:[jsx(Thumb,{ref:sliderRef,$animation:animation,$dimension:dimension,children:jsx(ThumbCircle,{$dimension:dimension,onTouchStart:e=>{e.stopPropagation(),props.onTouchStart?.(e),onSliderClick(0,"first")},onMouseDown:e=>{e.stopPropagation(),props.onMouseDown?.(e),onSliderClick(0,"first")},$active:isDraging})}),jsx(Thumb,{ref:slider2Ref,$animation:animation,$dimension:dimension,children:jsx(ThumbCircle,{$dimension:dimension,onTouchStart:e=>{e.stopPropagation(),props.onTouchStart?.(e),onSliderClick(0,"second")},onMouseDown:e=>{e.stopPropagation(),props.onMouseDown?.(e),onSliderClick(0,"second")},$active:isDraging2})})]})]})})})};Range.displayName="Range";export{Range};
//# sourceMappingURL=index.es.js.map
