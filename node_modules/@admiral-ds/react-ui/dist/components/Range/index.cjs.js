"use strict";var jsxRuntime=require("react/jsx-runtime"),e=require("react"),throttle=require("../common/utils/throttle.cjs.js"),utils=require("./utils.cjs.js"),style=require("./style.cjs.js");const Range=({minValue=0,maxValue=20,value:userValue,onChange,onRangeMouseUp,disabled=!1,step=1,dimension="m",skeleton=!1,...props})=>{const value=Array.isArray(userValue)&&2===userValue.length&&"number"==typeof userValue[0]&&"number"==typeof userValue[1]?utils.sortNum(userValue):[minValue,maxValue],[isDraging,setDrag]=e.useState(!1),[isDraging2,setDrag2]=e.useState(!1),[animation,setAnimation]=e.useState(!0),[rangeWidth,setRangeWidth]=e.useState(0),filledRef=e.useRef(null),trackRef=e.useRef(null),sliderRef=e.useRef(null),slider2Ref=e.useRef(null);e.useLayoutEffect(()=>{let newValue=value;if(step&&"any"!==step){if(newValue=[Math.round(newValue[0]/step)*step,Math.round(newValue[1]/step)*step],step.toString().includes(".")){const decimal=step.toString().match(/\.(\d+)/)?.[1].length;newValue=[+newValue[0].toFixed(decimal),+newValue[1].toFixed(decimal)]}}!function(value){const slider1Coords=utils.calcSliderCoords(value[0],minValue,maxValue,rangeWidth),slider2Coords=utils.calcSliderCoords(value[1],minValue,maxValue,rangeWidth);sliderRef.current&&slider2Ref.current&&filledRef.current&&(sliderRef.current.style.left=`${slider1Coords}%`,slider2Ref.current.style.left=`${slider2Coords}%`,filledRef.current.style.left=`${slider1Coords}%`,filledRef.current.style.right=100-slider2Coords+"%")}(value)},[value,rangeWidth,minValue,maxValue,step]),e.useLayoutEffect(()=>{if(trackRef.current){const resizeObserver=new ResizeObserver(entries=>{entries.forEach(entry=>setRangeWidth(entry.contentRect.width||0))});return resizeObserver.observe(trackRef.current),()=>{resizeObserver.disconnect()}}},[setRangeWidth]);const[moveListener,freeResources]=throttle.throttle(e=>{updateSlider(e)},50);e.useEffect(()=>(!isDraging&&!isDraging2||disabled||(document.addEventListener("mousemove",moveListener),document.addEventListener("mouseup",handleSliderMouseUp),document.addEventListener("touchmove",moveListener),document.addEventListener("touchend",handleSliderMouseUp),document.addEventListener("touchcancel",handleSliderMouseUp)),()=>{freeResources(),document.removeEventListener("mousemove",moveListener),document.removeEventListener("mouseup",handleSliderMouseUp),document.removeEventListener("touchmove",moveListener),document.removeEventListener("touchend",handleSliderMouseUp),document.removeEventListener("touchcancel",handleSliderMouseUp)}));const updateSlider=e=>{if(setAnimation(!1),isDraging||isDraging2){const calcVal=utils.calcValue(e,trackRef,minValue,maxValue,step);if(isDraging&&calcVal>value[1]){const newValue=[value[1],calcVal];setDrag(!1),setDrag2(!0),utils.arraysEqual(utils.sortNum(newValue),value)||onChange(e,utils.sortNum(newValue))}else if(isDraging2&&calcVal<value[0]){const newValue=[calcVal,value[0]];setDrag(!0),setDrag2(!1),utils.arraysEqual(utils.sortNum(newValue),value)||onChange(e,utils.sortNum(newValue))}else{const newValue=isDraging?[calcVal,value[1]]:[value[0],calcVal];utils.arraysEqual(utils.sortNum(newValue),value)||onChange(e,utils.sortNum(newValue))}}},onSliderClick=(_e,slider)=>{"first"===slider?setDrag(!0):setDrag2(!0),setAnimation(!0)},handleSliderMouseUp=e=>{const calcVal=utils.calcValue(e,trackRef,minValue,maxValue,step);if(onRangeMouseUp?.(),isDraging&&calcVal>value[1]){const newValue=[value[1],calcVal];utils.arraysEqual(utils.sortNum(newValue),value)||onChange(e,utils.sortNum(newValue))}if(isDraging2&&calcVal<value[0]){const newValue=[calcVal,value[0]];utils.arraysEqual(utils.sortNum(newValue),value)||onChange(e,utils.sortNum(newValue))}else{const newValue=isDraging?[calcVal,value[1]]:[value[0],calcVal];utils.arraysEqual(utils.sortNum(newValue),value)||onChange(e,utils.sortNum(newValue))}setAnimation(!0),setDrag(!1),setDrag2(!1)},onTrackClick=e=>{const calcVal=utils.calcValue(e,trackRef,minValue,maxValue,step);if(Math.abs(value[1]-calcVal)<Math.abs(calcVal-value[0]))utils.arraysEqual(utils.sortNum([value[0],calcVal]),value)||onChange(e,utils.sortNum([value[0],calcVal])),onSliderClick(0,"second");else if(Math.abs(value[1]-calcVal)>Math.abs(calcVal-value[0]))utils.arraysEqual(utils.sortNum([calcVal,value[1]]),value)||onChange(e,utils.sortNum([calcVal,value[1]])),onSliderClick(0,"first");else if(Math.abs(value[1]-calcVal)===Math.abs(calcVal-value[0])){const slider=value[0]===value[1]?calcVal<value[0]?"first":"second":"first",newValue="first"===slider?[calcVal,value[1]]:[value[0],calcVal];utils.arraysEqual(utils.sortNum(newValue),value)||onChange(e,utils.sortNum(newValue)),onSliderClick(0,slider)}};return jsxRuntime.jsx(style.Wrapper,{"data-disabled":disabled,$disabled:disabled,$skeleton:skeleton,...props,children:jsxRuntime.jsx(style.TrackWrapper,{$dimension:dimension,$skeleton:skeleton,onTouchStart:onTrackClick,onMouseDown:onTrackClick,children:jsxRuntime.jsxs(style.Track,{children:[jsxRuntime.jsx(style.FilledTrack,{ref:filledRef,$animation:animation}),jsxRuntime.jsxs(style.DefaultTrack,{ref:trackRef,children:[jsxRuntime.jsx(style.Thumb,{ref:sliderRef,$animation:animation,$dimension:dimension,children:jsxRuntime.jsx(style.ThumbCircle,{$dimension:dimension,onTouchStart:e=>{e.stopPropagation(),props.onTouchStart?.(e),onSliderClick(0,"first")},onMouseDown:e=>{e.stopPropagation(),props.onMouseDown?.(e),onSliderClick(0,"first")},$active:isDraging})}),jsxRuntime.jsx(style.Thumb,{ref:slider2Ref,$animation:animation,$dimension:dimension,children:jsxRuntime.jsx(style.ThumbCircle,{$dimension:dimension,onTouchStart:e=>{e.stopPropagation(),props.onTouchStart?.(e),onSliderClick(0,"second")},onMouseDown:e=>{e.stopPropagation(),props.onMouseDown?.(e),onSliderClick(0,"second")},$active:isDraging2})})]})]})})})};Range.displayName="Range",exports.Range=Range;
//# sourceMappingURL=index.cjs.js.map
