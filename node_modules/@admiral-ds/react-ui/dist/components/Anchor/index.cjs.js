"use strict";var jsxRuntime=require("react/jsx-runtime"),e=require("react"),styled=require("./styled.cjs.js"),AnchorItem=require("./AnchorItem.cjs.js"),ActiveVerticalSelector=require("./ActiveVerticalSelector.cjs.js"),utils=require("./utils.cjs.js"),debounce=require("../common/utils/debounce.cjs.js"),refSetter=require("../common/utils/refSetter.cjs.js");function getDefaultContainer(){return window}const treeToFlat=(tree,level=0,parent)=>tree.reduce((acc,item)=>{const key=item.key.toString(),{href,title}=item;if(acc.push({key,href,title,parent,level}),item.children&&(item=>!!item.children&&Array.isArray(item.children)&&item.children.length>0)(item)){const map=treeToFlat(item.children,level+1,key);return[...acc,...map]}return acc},[]),Anchor=e.forwardRef(({dimension="m",offsetTop=0,bounds=5,multilineView=!1,items,getAnchorContainer,...props},ref)=>{const getCurrentContainer=getAnchorContainer??getDefaultContainer,itemsMap=e.useMemo(()=>treeToFlat(items),[items]),itemsWithRef=e.useMemo(()=>itemsMap.map(item=>({...item,ref:e.createRef()})),[itemsMap]),[activeLink,setActiveLink]=e.useState(itemsMap[0]?.href||null),handleScroll=e.useCallback(()=>{const links=itemsMap.map(({href})=>href),container=getCurrentContainer(),activeLink=utils.getInternalCurrentAnchor(container,links,offsetTop,bounds);setActiveLink(activeLink)},[getAnchorContainer,itemsMap]),anchorContainerRef=e.useRef(null),[selectorTop,setSelectorTop]=e.useState(0),[selectorHeight,setSelectorHeight]=e.useState(0),selectorRef=e.useRef(null),styleSelector=(top,height)=>{setSelectorTop(top),setSelectorHeight(height)};e.useEffect(()=>{if(anchorContainerRef.current?.firstElementChild){const resizeObserver=new ResizeObserver(debounce.debounce(function(){const activeLinkRef=itemsWithRef.filter(item=>item.href===activeLink)?.[0]?.ref.current,top=parseFloat(selectorRef.current?.style.top||"0"),selectorHeight=parseFloat(selectorRef.current?.style.height||"0");if(activeLinkRef&&anchorContainerRef.current){const activeLinkHeight=activeLinkRef.getBoundingClientRect().height,activeLinkTop=activeLinkRef.getBoundingClientRect().top-anchorContainerRef.current.getBoundingClientRect().top+anchorContainerRef.current.scrollTop;activeLinkTop===top&&activeLinkHeight===selectorHeight||styleSelector(activeLinkTop,activeLinkHeight)}activeLinkRef||styleSelector(0,0)},100));return resizeObserver.observe(anchorContainerRef.current?.firstElementChild),()=>{resizeObserver.disconnect()}}},[itemsWithRef,activeLink,dimension,multilineView,offsetTop,bounds]),e.useEffect(()=>{const container=getCurrentContainer();return container.addEventListener("scroll",handleScroll),()=>{container.removeEventListener("scroll",handleScroll)}},[getAnchorContainer,handleScroll]);return jsxRuntime.jsxs(styled.AnchorContainer,{...props,ref:refSetter.refSetter(ref,anchorContainerRef),children:[itemsWithRef.map(item=>jsxRuntime.jsx(AnchorItem.AnchorItem,{ref:item.ref,dimension,multilineView,href:item.href,active:item.href===activeLink,level:item.level,children:item.title},item.key)),jsxRuntime.jsx(ActiveVerticalSelector.ActiveVerticalSelector,{$top:selectorTop,$height:selectorHeight,$transition:!0})]})});Anchor.displayName="Anchor",exports.Anchor=Anchor;
//# sourceMappingURL=index.cjs.js.map
