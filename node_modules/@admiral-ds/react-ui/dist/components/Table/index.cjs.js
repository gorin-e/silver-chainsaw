"use strict";var jsxRuntime=require("react/jsx-runtime"),e=require("react");require("../form/InputField/index.cjs.js");var index$1=require("../form/CheckboxField/index.cjs.js");require("../form/DateField/index.cjs.js"),require("../form/SelectField/index.cjs.js"),require("../form/FieldSet/index.cjs.js"),require("../form/SuggestField/index.cjs.js"),require("../form/TextField/index.cjs.js"),require("../form/SliderInputField/index.cjs.js"),require("../form/SliderRangeField/index.cjs.js"),require("../form/TimeField/index.cjs.js"),require("../form/NumberInputField/index.cjs.js"),require("../form/EditModeField/index.cjs.js"),require("../form/EditModeAreaField/index.cjs.js"),require("../form/PhoneInputField/index.cjs.js"),require("../form/InputExField/index.cjs.js"),require("../form/FileInputField/index.cjs.js"),require("../form/MultiInputField/index.cjs.js"),require("../form/TreeSelectField/index.cjs.js");var styled=require("styled-components"),index=require("../themes/light/index.cjs.js");require("../themes/common/locales.cjs.js"),require("../Typography/typography.cjs.js"),require("../Typography/defaultTypographyMixin.cjs.js");var GroupRow=require("./Row/GroupRow.cjs.js"),RegularRow=require("./Row/RegularRow.cjs.js"),RowWrapper=require("./Row/RowWrapper.cjs.js"),refSetter=require("../common/utils/refSetter.cjs.js"),debounce=require("../common/utils/debounce.cjs.js"),HeaderCell=require("./HeaderCell.cjs.js"),ColumnDrag=require("./drag/ColumnDrag.cjs.js"),RowDrag=require("./drag/RowDrag.cjs.js"),style=require("./style.cjs.js"),FixedSizeBody=require("./virtualScroll/FixedSizeBody.cjs.js"),DynamicSizeBody=require("./virtualScroll/DynamicSizeBody.cjs.js"),RowAction=require("./RowAction.cjs.js");function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(k){if("default"!==k){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:!0,get:function(){return e[k]}})}}),n.default=e,Object.freeze(n)}var e__namespace=_interopNamespace(e);const TABLE_ROW_STATUS_MAP={error:color=>color["Error/Error 20"],success:color=>color["Success/Success 20"]},Table=e__namespace.forwardRef(({columnList,rowList,displayRowSelectionColumn=!1,displayRowExpansionColumn=!1,headerCheckboxChecked=!1,headerCheckboxIndeterminate=!1,headerCheckboxDisabled=!1,onHeaderSelectionChange,onRowSelectionChange,onRowExpansionChange,onRowClick,onRowDoubleClick,onSortChange,onColumnResize,renderCell,renderRowWrapper,dimension="m",greyHeader=!1,greyZebraRows=!1,spacingBetweenItems,headerLineClamp=1,headerExtraLineClamp=1,showDividerForLastColumn=!1,disableColumnResize=!1,showLastRowUnderline=!0,showRowsActions:userShowRowsActions=!1,virtualScroll,locale,onColumnDrag,onColumnDragEnd,rowsDraggable=!1,onRowDrag,onRowDragEnd,draggedColumnCssMixin,draggedRowCssMixin,rowBackgroundColorByStatusMap:userRowBackgroundColorByStatusMap,showBorders=!1,...props},ref)=>{const theme=styled.useTheme()||index.LIGHT_THEME,checkboxDimension="s"===dimension||"m"===dimension?"s":"m",columnMinWidth="s"===dimension||"m"===dimension?25:33,[tableHeight,setTableHeight]=e__namespace.useState(0),[headerHeight,setHeaderHeight]=e__namespace.useState(0),stickyColumns=[...columnList].filter(col=>col.sticky),isAnyColumnDraggable=columnList.filter(col=>!col.sticky&&col.draggable).length>0,isAnyStickyColumnDraggable=columnList.filter(col=>col.sticky&&col.draggable).length>0,showRowsActions=e__namespace.useMemo(()=>rowList.some(row=>row.actionRender||row.overflowMenuRender)&&userShowRowsActions,[rowList,userShowRowsActions]),rowStatusMap=e__namespace.useMemo(()=>({...TABLE_ROW_STATUS_MAP,...userRowBackgroundColorByStatusMap}),[userRowBackgroundColorByStatusMap]),tableRef=e__namespace.useRef(null),headerRef=e__namespace.useRef(null),hiddenHeaderRef=e__namespace.useRef(null),bodyRef=e__namespace.useRef(null),stickyColumnsWrapperRef=e__namespace.useRef(null),normalColumnsWrapperRef=e__namespace.useRef(null),fillerRef=e__namespace.useRef(null),leftEdgeRef=e__namespace.useRef(null),rightEdgeRef=e__namespace.useRef(null),groupToRowsMap=rowList.reduce((acc,row)=>(void 0!==row.groupRows&&(acc[row.id]={rows:[...row.groupRows],expanded:!!row.expanded}),acc),{}),rowToGroupMap=Object.entries(groupToRowsMap).reduce((acc,[groupId,info])=>(info.rows.forEach(id=>{const row=rowList.find(item=>item.id.toString()===id);row&&!groupToRowsMap[id]&&(acc[id]={groupId,checked:!!row.selected})}),acc),{}),tableRows=e__namespace.useMemo(()=>(()=>{const tableRows=[];return rowList.forEach(row=>{const isGroupRow=!!groupToRowsMap[row.id];!!rowToGroupMap[row.id]||tableRows.push(row),isGroupRow&&groupToRowsMap[row.id].rows.forEach(rowId=>{const row=rowList.find(item=>item.id.toString()===rowId);row&&tableRows.push(row)})}),tableRows})(),[rowList]),zebraRows=greyZebraRows?tableRows.reduce((acc,row,index)=>{if(rowToGroupMap[row.id]){const indexInGroup=groupToRowsMap[rowToGroupMap[row.id]?.groupId]?.rows.indexOf(String(row.id));acc[row.id]="ingroup "+(indexInGroup%2==0?"odd":"even")}else groupToRowsMap[row.id]?acc[row.id]="group":0===index||acc[tableRows[index-1]?.id].includes("group")?acc[row.id]="odd":acc[row.id]="odd"===acc[tableRows[index-1]?.id]?"even":"odd";return acc},{}):{},updateColumnsWidth=()=>{const hiddenColumns=hiddenHeaderRef.current?.querySelectorAll(".th");hiddenColumns&&(Array.from(hiddenColumns).map(column=>({index:column.dataset.index,width:column.getBoundingClientRect().width})).map(({index,width})=>{index&&(headerRef.current?.style.setProperty(`--th-${index}-width`,width+"px"),bodyRef.current?.style.setProperty(`--td-${index}-width`,width+"px"))}),bodyRef.current&&headerRef.current&&bodyRef.current.style.setProperty("--header-scroll-width",headerRef.current.scrollWidth+"px"))};e__namespace.useLayoutEffect(()=>{if(hiddenHeaderRef.current){const hiddenColumns=hiddenHeaderRef.current?.querySelectorAll(".th"),resizeObserver=new ResizeObserver(debounce.debounce(updateColumnsWidth,100));return hiddenColumns?.forEach(col=>resizeObserver.observe(col)),()=>{resizeObserver.disconnect()}}},[hiddenHeaderRef.current,headerRef.current,bodyRef.current,columnList,rowList]),e__namespace.useLayoutEffect(()=>{updateColumnsWidth()}),e__namespace.useLayoutEffect(()=>{const table=tableRef.current;if(table){const resizeObserver=new ResizeObserver(()=>{setTableHeight(table.getBoundingClientRect().height)});return resizeObserver.observe(table),()=>{resizeObserver.disconnect()}}},[setTableHeight]),e__namespace.useLayoutEffect(()=>{const header=headerRef.current;if(header){const resizeObserver=new ResizeObserver(()=>{setHeaderHeight(header.getBoundingClientRect().height)});return resizeObserver.observe(header),()=>{resizeObserver.disconnect()}}},[setHeaderHeight]),e__namespace.useLayoutEffect(()=>{const filler=fillerRef.current;if(filler){const resizeObserver=new ResizeObserver(()=>{filler.dataset.empty=String(0==filler.getBoundingClientRect().width)});return resizeObserver.observe(filler),()=>{resizeObserver.disconnect()}}},[]),e__namespace.useLayoutEffect(()=>{const table=tableRef.current,leftEdge=leftEdgeRef.current,enableShadow=stickyColumns.length>0||displayRowSelectionColumn||displayRowExpansionColumn||rowsDraggable;if(table&&leftEdge&&enableShadow){const observer=new IntersectionObserver(function([entry]){table&&(entry.isIntersecting&&entry.intersectionRatio>.99?table.setAttribute("data-shadow-left","false"):table.setAttribute("data-shadow-left","true"))},{root:table,threshold:[0,1]});return observer.observe(leftEdge),()=>observer.disconnect()}},[stickyColumns,displayRowExpansionColumn,displayRowSelectionColumn,rowsDraggable]),e__namespace.useLayoutEffect(()=>{const table=tableRef.current,rightEdge=rightEdgeRef.current;if(table&&rightEdge&&showRowsActions){const observer=new IntersectionObserver(function([entry]){table&&(entry.isIntersecting&&entry.intersectionRatio>.99?table.setAttribute("data-shadow-right","false"):table.setAttribute("data-shadow-right","true"))},{root:table,threshold:[0,1]});return observer.observe(rightEdge),()=>observer.disconnect()}},[showRowsActions]);function handleCheckboxChange(id){const groupInfo=groupToRowsMap[id],rowHasGroup=rowToGroupMap[id],groupCheckStatus=groupInfo&&(groupInfo=>{const indeterminate=groupInfo.rows.some(rowId=>rowToGroupMap[rowId]?.checked)&&groupInfo.rows.some(rowId=>!rowToGroupMap[rowId]?.checked);return{checked:groupInfo.rows.every(rowId=>rowToGroupMap[rowId]?.checked),indeterminate}})(groupInfo),parentGroupNewValue=rowHasGroup&&(changedDepId=>{const groupId=rowToGroupMap[changedDepId]?.groupId,groupInfo=groupId?groupToRowsMap[groupId]:void 0;if(!groupInfo)return;const value=groupInfo?.rows.some(rowId=>rowId===changedDepId.toString()?!rowToGroupMap[rowId]?.checked:rowToGroupMap[rowId]?.checked);return{groupId,value}})(id),idsMap=rowList.reduce((ids,row)=>{if(groupInfo){const rowInCurrentGroup=groupInfo.rows.includes(row.id.toString());row.id===id||rowInCurrentGroup?ids[row.id]=!(groupCheckStatus?.indeterminate||groupCheckStatus?.checked):ids[row.id]=row.id===id?!row.selected:!!row.selected}else ids[row.id]=row.id===id?!row.selected:!!row.selected,rowHasGroup&&row.id===parentGroupNewValue?.groupId&&(ids[row.id]=parentGroupNewValue?.value);return ids},{});onRowSelectionChange?.(idsMap,id)}function handleExpansionChange(id){const idsMap=rowList.reduce((ids,row)=>{const value=row.id===id?!row.expanded:!!row.expanded;return ids[row.id]=value,ids},{});onRowExpansionChange?.(idsMap)}const isSelected=row=>row.selected,allRowsChecked=rowList.length>0&&rowList.every(isSelected),someRowsChecked=rowList.some(isSelected);const handleResizeChange=e__namespace.useCallback(({name,width})=>{onColumnResize?.({name,width:width+"px"})},[onColumnResize]),handleSort=e__namespace.useCallback((name,colSort)=>{let newSort="initial";"asc"===colSort&&(newSort="desc"),"desc"===colSort&&(newSort="initial"),"initial"===colSort&&(newSort="asc"),onSortChange?.({name,sort:newSort})},[onSortChange]),multipleSort=e__namespace.useMemo(()=>columnList.filter(col=>!!col.sort).length>1,[columnList]),renderHeaderCell=(column,index,hidden)=>jsxRuntime.jsx(HeaderCell.HeaderCellComponent,{column,index,columnsAmount:columnList.length,showDividerForLastColumn,disableColumnResize,headerLineClamp,headerExtraLineClamp,handleResizeChange,handleSort,dimension,spacingBetweenItems,multipleSort,columnMinWidth,hidden},`head_${column.name}`),renderBodyCell=idx=>(row,col)=>{const withResizer=col.name!==columnList[columnList.length-1].name||showDividerForLastColumn;return jsxRuntime.jsx(style.Cell,{$dimension:dimension,$resizer:withResizer,style:{width:`var(--td-${col.index}-width, 100px)`},className:"td","data-column":col.name,"data-row":row.id,children:col.renderCell?col.renderCell(row[col.name],row,idx):renderCell?renderCell(row,col.name):jsxRuntime.jsx(style.CellTextContent,{$cellAlign:col.cellAlign,children:row[col.name]})},`${row.id}_${col.name}`)},renderGroupRow=row=>{const indeterminate=row.groupRows?.some(rowId=>rowToGroupMap[rowId]?.checked)&&row.groupRows?.some(rowId=>!rowToGroupMap[rowId]?.checked),hasGroupRows=row.groupRows?.length,checked=hasGroupRows?row.groupRows?.every(rowId=>rowToGroupMap[rowId]?.checked):row.selected;return jsxRuntime.jsx(GroupRow.GroupRow,{row,dimension,checkboxDimension,displayRowExpansionColumn,displayRowSelectionColumn,rowsDraggable,onRowExpansionChange:handleExpansionChange,onRowSelectionChange:handleCheckboxChange,renderCell,indeterminate,checked})},renderRegularRow=(row,idx)=>jsxRuntime.jsx(RegularRow.RegularRow,{row,dimension,checkboxDimension,columns:columnList,stickyColumns,displayRowExpansionColumn,displayRowSelectionColumn,rowsDraggable,renderBodyCell:renderBodyCell(idx),onRowExpansionChange:handleExpansionChange,onRowSelectionChange:handleCheckboxChange}),renderRow=(row,index)=>{const isGroupRow=!!groupToRowsMap[row.id],visible=!!!rowToGroupMap[row.id]||groupToRowsMap[rowToGroupMap[row.id]?.groupId]?.expanded,isLastRow=(({row,isGroupRow,index,tableRows})=>isGroupRow?!row.expanded&&row.groupRows&&index>=tableRows.length-(row.groupRows.length+1):index===tableRows.length-1)({row,isGroupRow,tableRows,index}),rowWidth=isGroupRow?`var(--header-scroll-width, ${headerRef.current?.scrollWidth+"px"})`:void 0,node=(isGroupRow||visible)&&jsxRuntime.jsx(RowWrapper.RowWrapper,{dimension,row,underline:isLastRow&&showLastRowUnderline&&!showBorders||!isLastRow,isGroup:isGroupRow,groupId:rowToGroupMap[row.id]?.groupId??null,onRowClick,onRowDoubleClick,rowWidth,grey:zebraRows[row.id]?.includes("even"),showRowsActions,rowStatusMap,tableRef,headerHeight,children:isGroupRow?renderGroupRow(row):renderRegularRow(row,index)},`row_${row.id}`);return node?renderRowWrapper?.(row,index,node)??node:node},renderEmptyMessage=()=>{const emptyMessage=locale?.emptyMessage||theme.locales[theme.currentLocale].table.emptyMessage;return jsxRuntime.jsx(style.Row,{$underline:showLastRowUnderline,$dimension:dimension,className:"tr",$rowWidth:`var(--header-scroll-width, ${headerRef.current?.scrollWidth+"px"})`,children:jsxRuntime.jsx(style.EmptyMessage,{$dimension:dimension,children:emptyMessage})})};return jsxRuntime.jsxs(style.TableContainer,{ref:refSetter.refSetter(ref,tableRef),"data-shadow-left":!1,"data-shadow-right":!1,"data-borders":showBorders,"data-dragging":!1,...props,className:`table ${props.className||""}`,children:[jsxRuntime.jsxs(style.HiddenHeader,{ref:hiddenHeaderRef,$dimension:dimension,children:[(displayRowSelectionColumn||displayRowExpansionColumn||rowsDraggable||showRowsActions)&&jsxRuntime.jsxs(style.StickyWrapper,{children:[rowsDraggable&&jsxRuntime.jsx(style.DragCell,{$dimension:dimension}),displayRowExpansionColumn&&jsxRuntime.jsx(style.ExpandCell,{$dimension:dimension}),displayRowSelectionColumn&&jsxRuntime.jsx(style.CheckboxCell,{$dimension:dimension,children:jsxRuntime.jsx(index$1.CheckboxField,{dimension:checkboxDimension})}),showRowsActions&&jsxRuntime.jsx(style.ActionMock,{$dimension:dimension})]}),jsxRuntime.jsxs(style.HeaderCellsWrapper,{$expansionColumn:displayRowExpansionColumn,$selectionColumn:displayRowSelectionColumn,$overflowMenuColumn:showRowsActions,$dimension:dimension,children:[stickyColumns.length>0&&stickyColumns.map((col,index)=>renderHeaderCell(col,index,!0)),columnList.map((col,index)=>col.sticky?null:renderHeaderCell(col,index,!0))]})]}),jsxRuntime.jsx(style.HeaderWrapper,{className:"thead",children:jsxRuntime.jsxs(style.Header,{$dimension:dimension,$greyHeader:greyHeader,ref:headerRef,className:"tr",children:[(displayRowSelectionColumn||displayRowExpansionColumn||stickyColumns.length>0||rowsDraggable)&&jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[jsxRuntime.jsx(style.Edge,{ref:leftEdgeRef}),jsxRuntime.jsxs(style.StickyWrapper,{ref:stickyColumnsWrapperRef,$greyHeader:greyHeader,children:[rowsDraggable&&jsxRuntime.jsx(style.DragCell,{$dimension:dimension,"data-draggable":!1,"data-droppable":!1}),displayRowExpansionColumn&&jsxRuntime.jsx(style.ExpandCell,{$dimension:dimension,"data-draggable":!1,"data-droppable":!1}),displayRowSelectionColumn&&jsxRuntime.jsx(style.CheckboxCell,{$dimension:dimension,className:"th_checkbox","data-th-column":"checkbox","data-draggable":!1,"data-droppable":!1,children:jsxRuntime.jsx(index$1.CheckboxField,{dimension:checkboxDimension,checked:allRowsChecked||someRowsChecked||headerCheckboxChecked,indeterminate:someRowsChecked&&!allRowsChecked||headerCheckboxIndeterminate,disabled:0===tableRows.length||headerCheckboxDisabled,onChange:function(e){const toRemove=rowList.reduce((ids,row)=>(ids[row.id]=row.checkboxDisabled?!!row.selected:!someRowsChecked,ids),{});onRowSelectionChange?.(toRemove),onHeaderSelectionChange?.(e.target.checked)}})}),stickyColumns.length>0&&stickyColumns.map((col,index)=>renderHeaderCell(col,index))]})]}),jsxRuntime.jsx(style.NormalWrapper,{ref:normalColumnsWrapperRef,children:columnList.map((col,index)=>col.sticky?null:renderHeaderCell(col,index))}),jsxRuntime.jsx(style.Filler,{ref:fillerRef}),showRowsActions&&jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[jsxRuntime.jsx(style.ActionMock,{$dimension:dimension}),jsxRuntime.jsx(style.Edge,{ref:rightEdgeRef})]})]})}),virtualScroll&&(virtualScroll.fixedRowHeight||virtualScroll.estimatedRowHeight)?virtualScroll.fixedRowHeight?jsxRuntime.jsx(FixedSizeBody.FixedSizeBody,{rowList:tableRows,childHeight:virtualScroll.fixedRowHeight,renderRow,renderEmptyMessage:tableRows.length?void 0:renderEmptyMessage,ref:bodyRef,className:"tbody",tableRef,tableHeight,headerHeight}):jsxRuntime.jsx(DynamicSizeBody.DynamicSizeBody,{tableRef,tableHeight,headerHeight,rowList:tableRows,renderRow,renderEmptyMessage:tableRows.length?void 0:renderEmptyMessage,estimatedRowHeight:virtualScroll.estimatedRowHeight,ref:bodyRef,className:"tbody"}):jsxRuntime.jsx(style.Body,{ref:bodyRef,className:"tbody",children:tableRows.length?tableRows.map((row,index)=>renderRow(row,index)):renderEmptyMessage()}),jsxRuntime.jsx(ColumnDrag.ColumnDrag,{onColumnDrag,onColumnDragEnd,dimension,isAnyColumnDraggable,isAnyStickyColumnDraggable,tableRef,normalColumnsWrapperRef,stickyColumnsWrapperRef,draggedColumnCssMixin}),jsxRuntime.jsx(RowDrag.RowDrag,{onRowDrag,onRowDragEnd,dimension,rowsDraggable,tableRef,bodyRef,rowToGroupMap,draggedRowCssMixin})]})});Table.displayName="Table",exports.RowAction=RowAction.RowAction,exports.DEFAULT_COLUMN_WIDTH=100,exports.Table=Table;
//# sourceMappingURL=index.cjs.js.map
