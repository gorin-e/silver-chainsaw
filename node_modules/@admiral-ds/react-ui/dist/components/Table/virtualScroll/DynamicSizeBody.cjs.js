"use strict";var jsxRuntime=require("react/jsx-runtime"),e=require("react"),style=require("../style.cjs.js"),utils=require("./utils.cjs.js"),VirtualRowWrapper=require("./VirtualRowWrapper.cjs.js");const DynamicSizeBody=e.forwardRef(({rowList,tableHeight,headerHeight,renderAhead=20,renderRow,renderEmptyMessage,estimatedRowHeight=()=>40,tableRef},ref)=>{const[measurementCache,setMeasurementCache]=e.useState({}),[scrollTop,setScrollTop]=e.useState(0),[height,setHeight]=e.useState(tableHeight-headerHeight),measurementCacheRef=e.useRef(measurementCache);e.useEffect(()=>{setHeight(tableHeight-headerHeight)},[tableHeight,headerHeight]),e.useLayoutEffect(()=>{measurementCacheRef.current=measurementCache});const rowNodes=e.useMemo(()=>rowList.filter((row,index)=>Boolean(renderRow(row,index))),[rowList,renderRow]),itemsCount=e.useMemo(()=>rowNodes.length,[rowNodes]),getItemKey=e.useCallback(index=>rowNodes[index].id,[rowNodes]);e.useEffect(()=>{function handleScroll(e){requestAnimationFrame(()=>{setScrollTop(e.target.scrollTop)})}const scrollContainer=tableRef.current;return setScrollTop(scrollContainer?.scrollTop||0),scrollContainer?.addEventListener("scroll",handleScroll),()=>scrollContainer?.removeEventListener("scroll",handleScroll)},[tableRef]);const{allItems,totalHeight}=e.useMemo(()=>{let totalHeight=0;const allRows=Array(itemsCount);for(let index=0;index<itemsCount;index++){const key=getItemKey(index),row={key,index,height:measurementCache[key]??estimatedRowHeight(index),offsetTop:totalHeight};totalHeight+=row.height,allRows[index]=row}return{allItems:allRows,totalHeight}},[getItemKey,estimatedRowHeight,measurementCache,itemsCount,rowNodes]),startIndex=e.useMemo(()=>{const start=itemsCount?utils.findStartIndex(scrollTop,allItems,itemsCount):0;return Math.max(0,start-renderAhead)},[scrollTop,allItems,itemsCount,renderAhead]),endIndex=e.useMemo(()=>{const end=itemsCount?utils.findEndIndex(allItems,startIndex,scrollTop+height,itemsCount):0;return Math.min(itemsCount-1,end+renderAhead)},[allItems,startIndex,scrollTop,height,itemsCount,renderAhead]),topPadding=allItems[startIndex]?.offsetTop,bottomPadding=totalHeight-(allItems[endIndex]?.offsetTop+allItems[endIndex]?.height),virtualItems=e.useMemo(()=>allItems.slice(startIndex,endIndex+1),[allItems,startIndex,endIndex]);return jsxRuntime.jsx(style.Body,{ref,style:{height},children:renderEmptyMessage?renderEmptyMessage():jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[jsxRuntime.jsx(style.Spacer,{style:{minHeight:topPadding}}),virtualItems.map(virtualItem=>{const item=rowNodes[virtualItem.index];return jsxRuntime.jsx(VirtualRowWrapper.VirtualRowWrapper,{id:item.id,cacheRef:measurementCacheRef,setCache:setMeasurementCache,children:renderRow(item,virtualItem.index)},item.id)}),jsxRuntime.jsx(style.Spacer,{style:{minHeight:bottomPadding}})]})})});exports.DynamicSizeBody=DynamicSizeBody;
//# sourceMappingURL=DynamicSizeBody.cjs.js.map
