"use strict";var jsxRuntime=require("react/jsx-runtime"),styled=require("styled-components"),usePrevious=require("../common/hooks/usePrevious.cjs.js"),e=require("react");function _interopDefault(e){return e&&e.__esModule?e:{default:e}}const Spacer=_interopDefault(styled).default.div`
  display: flex;
  flex: 0 0 auto;
`;exports.VirtualBody=({scrollContainerRef,itemHeight,rowCount=6,aheadItemsCount=3,model,activeId,selected,onRenderItem})=>{const[scrollTop,setScrollTop]=e.useState(0),[partition,setPartition]=e.useState({startIndex:0,endIndex:rowCount,topPadding:"",bottomPadding:"",needAddListener:!1}),prevValue=usePrevious.usePrevious({activeId}),handleScroll=e.useCallback(e=>{requestAnimationFrame(()=>{e.target&&setScrollTop(e.target.scrollTop)})},[scrollContainerRef]);e.useEffect(()=>{const scrollContainer=scrollContainerRef.current;return setScrollTop(scrollContainer?.scrollTop||0),scrollContainer?.addEventListener("scroll",handleScroll),()=>scrollContainer?.removeEventListener("scroll",handleScroll)},[handleScroll]),e.useEffect(()=>{partition.needAddListener&&(setTimeout(()=>scrollContainerRef?.current?.addEventListener("scroll",handleScroll)),setPartition({...partition,needAddListener:!1}))},[partition,scrollContainerRef]);const calcPartition=e.useCallback(start=>{const itemCount=model.length,startIndex=Math.max(0,start);let visibleNodeCount=rowCount+2*aheadItemsCount;visibleNodeCount=Math.min(itemCount-startIndex,visibleNodeCount);return{startIndex,endIndex:startIndex+visibleNodeCount,topPadding:startIndex*itemHeight+"px",bottomPadding:(itemCount-startIndex-visibleNodeCount)*itemHeight+"px"}},[itemHeight,aheadItemsCount,model,rowCount]);e.useEffect(()=>{const start=Math.floor(scrollTop/itemHeight-aheadItemsCount),partition={...calcPartition(start),needAddListener:!1};setPartition(partition)},[scrollTop,calcPartition]),e.useEffect(()=>{if(!activeId||!prevValue)return;if(prevValue.activeId===activeId)return;const index=model.findIndex(item=>item.id===activeId);-1!==index&&(index<partition.startIndex||index>partition.endIndex)&&(scrollContainerRef?.current?.removeEventListener("scroll",handleScroll),setPartition({...calcPartition(index),needAddListener:!0}))},[activeId,partition,calcPartition,scrollContainerRef]);const visibleChildren=e.useMemo(()=>[...model].slice(partition.startIndex,partition.endIndex).map((item,index)=>onRenderItem?.(item,index)),[model,activeId,selected,partition]);return jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[jsxRuntime.jsx(Spacer,{style:{minHeight:partition.topPadding}}),visibleChildren,jsxRuntime.jsx(Spacer,{style:{minHeight:partition.bottomPadding}})]})};
//# sourceMappingURL=VirtualBody.cjs.js.map
