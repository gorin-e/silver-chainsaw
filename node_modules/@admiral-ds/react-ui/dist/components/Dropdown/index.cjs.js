"use strict";var jsxRuntime=require("react/jsx-runtime"),e=require("react"),styled=require("styled-components"),useClickOutside=require("../common/hooks/useClickOutside.cjs.js"),parseShadowFromTheme=require("../common/utils/parseShadowFromTheme.cjs.js"),PositionInPortal=require("../PositionInPortal.cjs.js"),useInterval=require("../common/hooks/useInterval.cjs.js"),keyboardKey=require("../common/keyboardKey.cjs.js"),utils=require("./utils.cjs.js"),refSetter=require("../common/utils/refSetter.cjs.js"),borderRadius=require("../themes/borderRadius.cjs.js"),DropdownProvider=require("../DropdownProvider.cjs.js");function _interopDefault(e){return e&&e.__esModule?e:{default:e}}function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(k){if("default"!==k){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:!0,get:function(){return e[k]}})}}),n.default=e,Object.freeze(n)}var e__namespace=_interopNamespace(e),styled__default=_interopDefault(styled);const Container=styled__default.default.div`
  pointer-events: initial;
  margin: 8px 0;
  background-color: var(--admiral-color-Special_ElevatedBG, ${p=>p.theme.color["Special/Elevated BG"]});
  border-radius: var(--admiral-border-radius-Medium, ${p=>borderRadius.mediumGroupBorderRadius(p.theme.shape)});
  box-shadow: var(--admiral-box-shadow-Shadow08, ${p=>parseShadowFromTheme.parseShadow(p.theme.shadow["Shadow 08"])});
  flex: 0 0 auto;
  ${p=>p.$alignSelf?`align-self: ${p.$alignSelf}`:""};
  opacity: 0;
  transition-delay: 200ms;
  transition-property: opacity;
  ${p=>p.$dropContainerCssMixin}
`,FakeTarget=styled__default.default.div`
  pointer-events: none;
  height: 100%;
  flex: 0 0 auto;
`,Portal=styled__default.default(PositionInPortal.PositionInPortal)`
  display: flex;
  flex-direction: ${p=>p.$reverse?"column-reverse":"column"};
  flex-wrap: nowrap;
`,Dropdown=e__namespace.forwardRef(({targetRef,onClickOutside=()=>null,onKeyDown,className="",onMenuReachBottom,onMenuReachTop,menuFocus,alignSelf,dropContainerCssMixin,...props},ref)=>{const containerRef=e__namespace.useRef(null),[displayUpward,setDisplayUpward]=e__namespace.useState(!1),{addDropdown,removeDropdown,dropdowns}=DropdownProvider.useDropdown(containerRef),{rootRef}=e__namespace.useContext(DropdownProvider.DropdownContext);useClickOutside.useClickOutside([containerRef],e=>{DropdownProvider.useDropdownsClickOutside(e,dropdowns)&&onClickOutside(e)});const handleKeyDown=e__namespace.useCallback(e=>{const focusedOption=(containerRef.current&&containerRef.current.ownerDocument||document).activeElement,code=keyboardKey.keyboardKey.getCode(e);menuFocus?code===keyboardKey.keyboardKey.ArrowRight?(utils.moveFocus(containerRef.current,focusedOption,utils.nextItem,!0,!0,onMenuReachTop,onMenuReachBottom),e.preventDefault()):code===keyboardKey.keyboardKey.ArrowLeft&&(utils.moveFocus(containerRef.current,focusedOption,utils.previousItem,!0,!0,onMenuReachTop,onMenuReachBottom),e.preventDefault()):code===keyboardKey.keyboardKey.ArrowDown?(utils.moveFocus(containerRef.current,focusedOption,utils.nextItem),e.preventDefault()):code===keyboardKey.keyboardKey.ArrowUp&&(utils.moveFocus(containerRef.current,focusedOption,utils.previousItem),e.preventDefault()),32===e.keyCode?e.preventDefault():code===keyboardKey.keyboardKey.Home?(e.preventDefault(),utils.moveFocus(containerRef.current,null,utils.nextItem)):code===keyboardKey.keyboardKey.End&&(e.preventDefault(),utils.moveFocus(containerRef.current,null,utils.previousItem)),onKeyDown?.(e)},[containerRef.current,menuFocus,utils.previousItem,utils.nextItem]),getMenuFirstOption=()=>{let option=containerRef.current?.firstElementChild;for(;option?.hasAttribute("disabled");)option=option.nextElementSibling;return option};e__namespace.useLayoutEffect(()=>{if(containerRef.current!==document.activeElement&&containerRef?.current?.focus(),menuFocus){const activeOption=containerRef.current?.querySelector('[aria-selected="true"]'),selectedItem="firstOption"===menuFocus?getMenuFirstOption():"lastOption"===menuFocus?(()=>{let option=containerRef.current?.lastElementChild;for(;option?.hasAttribute("disabled");)option=option.previousElementSibling;return option})():activeOption||getMenuFirstOption();selectedItem?.focus()}else{const focusedOption=(containerRef.current&&containerRef.current.ownerDocument||document).activeElement;utils.moveFocus(containerRef.current,focusedOption,utils.nextItem)}},[containerRef,menuFocus,utils.nextItem,utils.moveFocus]);const checkDropdownPosition=e__namespace.useCallback(()=>{const node=containerRef.current,targetNode=targetRef.current;if(node&&targetNode){const rect=node.getBoundingClientRect(),targetRect=targetNode.getBoundingClientRect(),viewportHeight=globalThis.innerHeight,viewportWidth=globalThis.innerWidth;if(viewportHeight-rect.bottom<0&&targetRect.top>viewportHeight-targetRect.bottom?displayUpward||setDisplayUpward(!0):(targetRect.bottom+(targetRect.top-rect.top)<viewportHeight-8||targetRect.top<viewportHeight-targetRect.bottom)&&displayUpward&&setDisplayUpward(!1),!props.disableAutoAlign){const rectWidth=rect.right-rect.left;targetRect.right<rectWidth&&viewportWidth-targetRect.left<rectWidth?node.style.alignSelf="center":targetRect.right-16>=rectWidth&&viewportWidth-targetRect.left>=rectWidth?node.style.alignSelf="":targetRect.right-16<rectWidth?node.style.alignSelf="flex-start":viewportWidth-targetRect.left<rectWidth&&(node.style.alignSelf="flex-end")}}},[displayUpward]);return useInterval.useInterval(checkDropdownPosition,100),e__namespace.useEffect(()=>{containerRef.current&&(containerRef.current.style.opacity="1")},[containerRef.current]),e__namespace.useLayoutEffect(()=>(addDropdown?.(containerRef),()=>{removeDropdown?.(containerRef)}),[]),jsxRuntime.jsxs(Portal,{targetElement:targetRef.current,$reverse:displayUpward,rootRef,children:[jsxRuntime.jsx(FakeTarget,{}),jsxRuntime.jsx(Container,{ref:refSetter.refSetter(ref,containerRef),...props,onKeyDown:handleKeyDown,className:className+" dropdown-container",$alignSelf:alignSelf,$dropContainerCssMixin:dropContainerCssMixin})]})});Dropdown.displayName="Dropdown",exports.Dropdown=Dropdown;
//# sourceMappingURL=index.cjs.js.map
