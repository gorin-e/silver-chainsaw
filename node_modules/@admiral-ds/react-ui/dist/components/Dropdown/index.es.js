import{jsxs,jsx}from"react/jsx-runtime";import*as e from"react";import styled from"styled-components";import{useClickOutside}from"../common/hooks/useClickOutside.es.js";import{parseShadow}from"../common/utils/parseShadowFromTheme.es.js";import{PositionInPortal}from"../PositionInPortal.es.js";import{useInterval}from"../common/hooks/useInterval.es.js";import{keyboardKey}from"../common/keyboardKey.es.js";import{moveFocus,previousItem,nextItem}from"./utils.es.js";import{refSetter}from"../common/utils/refSetter.es.js";import{mediumGroupBorderRadius}from"../themes/borderRadius.es.js";import{useDropdown,DropdownContext,useDropdownsClickOutside}from"../DropdownProvider.es.js";const Container=styled.div`
  pointer-events: initial;
  margin: 8px 0;
  background-color: var(--admiral-color-Special_ElevatedBG, ${p=>p.theme.color["Special/Elevated BG"]});
  border-radius: var(--admiral-border-radius-Medium, ${p=>mediumGroupBorderRadius(p.theme.shape)});
  box-shadow: var(--admiral-box-shadow-Shadow08, ${p=>parseShadow(p.theme.shadow["Shadow 08"])});
  flex: 0 0 auto;
  ${p=>p.$alignSelf?`align-self: ${p.$alignSelf}`:""};
  opacity: 0;
  transition-delay: 200ms;
  transition-property: opacity;
  ${p=>p.$dropContainerCssMixin}
`,FakeTarget=styled.div`
  pointer-events: none;
  height: 100%;
  flex: 0 0 auto;
`,Portal=styled(PositionInPortal)`
  display: flex;
  flex-direction: ${p=>p.$reverse?"column-reverse":"column"};
  flex-wrap: nowrap;
`,Dropdown=e.forwardRef(({targetRef,onClickOutside=()=>null,onKeyDown,className="",onMenuReachBottom,onMenuReachTop,menuFocus,alignSelf,dropContainerCssMixin,...props},ref)=>{const containerRef=e.useRef(null),[displayUpward,setDisplayUpward]=e.useState(!1),{addDropdown,removeDropdown,dropdowns}=useDropdown(containerRef),{rootRef}=e.useContext(DropdownContext);useClickOutside([containerRef],e=>{useDropdownsClickOutside(e,dropdowns)&&onClickOutside(e)});const handleKeyDown=e.useCallback(e=>{const focusedOption=(containerRef.current&&containerRef.current.ownerDocument||document).activeElement,code=keyboardKey.getCode(e);menuFocus?code===keyboardKey.ArrowRight?(moveFocus(containerRef.current,focusedOption,nextItem,!0,!0,onMenuReachTop,onMenuReachBottom),e.preventDefault()):code===keyboardKey.ArrowLeft&&(moveFocus(containerRef.current,focusedOption,previousItem,!0,!0,onMenuReachTop,onMenuReachBottom),e.preventDefault()):code===keyboardKey.ArrowDown?(moveFocus(containerRef.current,focusedOption,nextItem),e.preventDefault()):code===keyboardKey.ArrowUp&&(moveFocus(containerRef.current,focusedOption,previousItem),e.preventDefault()),32===e.keyCode?e.preventDefault():code===keyboardKey.Home?(e.preventDefault(),moveFocus(containerRef.current,null,nextItem)):code===keyboardKey.End&&(e.preventDefault(),moveFocus(containerRef.current,null,previousItem)),onKeyDown?.(e)},[containerRef.current,menuFocus,previousItem,nextItem]),getMenuFirstOption=()=>{let option=containerRef.current?.firstElementChild;for(;option?.hasAttribute("disabled");)option=option.nextElementSibling;return option};e.useLayoutEffect(()=>{if(containerRef.current!==document.activeElement&&containerRef?.current?.focus(),menuFocus){const activeOption=containerRef.current?.querySelector('[aria-selected="true"]'),selectedItem="firstOption"===menuFocus?getMenuFirstOption():"lastOption"===menuFocus?(()=>{let option=containerRef.current?.lastElementChild;for(;option?.hasAttribute("disabled");)option=option.previousElementSibling;return option})():activeOption||getMenuFirstOption();selectedItem?.focus()}else{const focusedOption=(containerRef.current&&containerRef.current.ownerDocument||document).activeElement;moveFocus(containerRef.current,focusedOption,nextItem)}},[containerRef,menuFocus,nextItem,moveFocus]);const checkDropdownPosition=e.useCallback(()=>{const node=containerRef.current,targetNode=targetRef.current;if(node&&targetNode){const rect=node.getBoundingClientRect(),targetRect=targetNode.getBoundingClientRect(),viewportHeight=globalThis.innerHeight,viewportWidth=globalThis.innerWidth;if(viewportHeight-rect.bottom<0&&targetRect.top>viewportHeight-targetRect.bottom?displayUpward||setDisplayUpward(!0):(targetRect.bottom+(targetRect.top-rect.top)<viewportHeight-8||targetRect.top<viewportHeight-targetRect.bottom)&&displayUpward&&setDisplayUpward(!1),!props.disableAutoAlign){const rectWidth=rect.right-rect.left;targetRect.right<rectWidth&&viewportWidth-targetRect.left<rectWidth?node.style.alignSelf="center":targetRect.right-16>=rectWidth&&viewportWidth-targetRect.left>=rectWidth?node.style.alignSelf="":targetRect.right-16<rectWidth?node.style.alignSelf="flex-start":viewportWidth-targetRect.left<rectWidth&&(node.style.alignSelf="flex-end")}}},[displayUpward]);return useInterval(checkDropdownPosition,100),e.useEffect(()=>{containerRef.current&&(containerRef.current.style.opacity="1")},[containerRef.current]),e.useLayoutEffect(()=>(addDropdown?.(containerRef),()=>{removeDropdown?.(containerRef)}),[]),jsxs(Portal,{targetElement:targetRef.current,$reverse:displayUpward,rootRef,children:[jsx(FakeTarget,{}),jsx(Container,{ref:refSetter(ref,containerRef),...props,onKeyDown:handleKeyDown,className:className+" dropdown-container",$alignSelf:alignSelf,$dropContainerCssMixin:dropContainerCssMixin})]})});Dropdown.displayName="Dropdown";export{Dropdown};
//# sourceMappingURL=index.es.js.map
