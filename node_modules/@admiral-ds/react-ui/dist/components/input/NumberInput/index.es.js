import{jsx,jsxs}from"react/jsx-runtime";import{forwardRef,useState,useRef,useEffect,Children,useMemo}from"react";import styled,{css,useTheme}from"styled-components";import{LIGHT_THEME}from"../../themes/light/index.es.js";import"../../themes/common/locales.es.js";import{typography}from"../../Typography/typography.es.js";import"../../Typography/defaultTypographyMixin.es.js";import{changeInputData}from"../../common/dom/changeInputData.es.js";import{refSetter}from"../../common/utils/refSetter.es.js";import{ReactComponent as SvgCloseOutline}from"../../../node_modules/@admiral-ds/icons/build/service/CloseOutline.svg.es.js";import{ReactComponent as SvgMinusOutline}from"../../../node_modules/@admiral-ds/icons/build/service/MinusOutline.svg.es.js";import{ReactComponent as SvgPlusOutline}from"../../../node_modules/@admiral-ds/icons/build/service/PlusOutline.svg.es.js";import{InputIconButton}from"../../InputIconButton.es.js";import{keyboardKey}from"../../common/keyboardKey.es.js";import{HeightLimitedContainer}from"../Container.es.js";import{horizontalPaddingValue,iconSizeValue,BorderedDiv,AutoSizeInput}from"./AutoSizeInput.es.js";import{validateThousand,getThousandSeparator,getDecimalSeparator,clearValue,fitToCurrency}from"./utils.es.js";import{createNumberInputHandler}from"./createNumberInputHandler.es.js";const extraPadding=css`
  padding-right: ${props=>horizontalPaddingValue(props)+(iconSizeValue(props)+8)*(props.$iconsAfterCount??0)}px;
`,preventDefault=e=>e.preventDefault(),PlusMinusIcon=styled(InputIconButton)`
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  ${({disabled,theme})=>disabled?css`
          cursor: not-allowed;

          & *[fill^='#'],
          &:hover *[fill^='#'] {
            fill: var(--admiral-color-Neutral_Neutral30, ${theme.color["Neutral/Neutral 30"]});
          }
        `:""}
`,IconPanel=styled.div`
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;

  display: flex;
  align-items: center;
  margin-right: ${horizontalPaddingValue}px;

  & svg {
    display: block;
    width: ${iconSizeValue}px;
  }

  & > * {
    margin-left: 8px;
  }
`,Content=styled.div`
  display: flex;
  box-sizing: border-box;
  width: 100%;
  overflow: hidden;
  padding: 0 ${horizontalPaddingValue}px;
  ${extraPadding};
  border-radius: inherit;
`,Wrapper=styled(HeightLimitedContainer)`
  background-color: ${({disabled,readOnly,theme})=>disabled||readOnly?`var(--admiral-color-Neutral_Neutral10, ${theme.color["Neutral/Neutral 10"]})`:`var(--admiral-color-Neutral_Neutral00, ${theme.color["Neutral/Neutral 00"]})`};
  color: ${({disabled,theme})=>disabled?`var(--admiral-color-Neutral_Neutral30, ${theme.color["Neutral/Neutral 30"]})`:`var(--admiral-color-Neutral_Neutral90, ${theme.color["Neutral/Neutral 90"]})`};
  ${({$dimension})=>"s"===$dimension?typography["Body/Body 2 Long"]:typography["Body/Body 1 Long"]}
  overflow: hidden;
  ${({disabled})=>disabled?"cursor: not-allowed;":""}

  &:hover:not(:focus-within) ${BorderedDiv} {
    border: 1px solid
      ${({disabled,readOnly,$status,theme})=>disabled||readOnly?"transparent":"error"===$status?`var(--admiral-color-Error_Error70, ${theme.color["Error/Error 70"]})`:"success"===$status?`var(--admiral-color-Success_Success60, ${theme.color["Success/Success 60"]})`:`var(--admiral-color-Neutral_Neutral60, ${theme.color["Neutral/Neutral 60"]})`};
  }
  &:hover:not(:focus-within) input:user-invalid + ${BorderedDiv} {
    border: 1px solid var(--admiral-color-Error_Error70, ${p=>p.theme.color["Error/Error 70"]});
  }
`,NumberInput=forwardRef(({className,style,containerRef,status,icons,iconsAfter,displayClearIcon=!1,displayPlusMinusIcons=!0,prefix,suffix,precision=2,thousand:userThousand,decimal:userDecimal,fillEmptyDecimals=!0,step=1,minValue=Number.NEGATIVE_INFINITY,maxValue=Number.POSITIVE_INFINITY,placeholder,align="left",skeleton=!1,onChange,onBlur,createInputHandler=createNumberInputHandler,handleInput,disableCopying,...props},ref)=>{const[plusDisabled,setPlusDisabled]=useState(!1),[minusDisabled,setMinusDisabled]=useState(!1),[innerValueState,setInnerValueState]=useState(props.defaultValue),innerValue=props.value??innerValueState,inputRef=useRef(null),theme=useTheme()||LIGHT_THEME,thousand=void 0!==userThousand&&validateThousand(userThousand)?userThousand.slice(0,1):getThousandSeparator(theme.currentLocale),decimal=userDecimal?.slice(0,1)??getDecimalSeparator(theme.currentLocale);useEffect(()=>{if(innerValue||0===innerValue){const num=Number(clearValue(String(innerValue),precision,decimal).replace(decimal,"."));setMinusDisabled(num<=minValue),setPlusDisabled(num>=maxValue)}else setMinusDisabled(!1),setPlusDisabled(!1)},[innerValue]);const handleMinus=()=>{const current=inputRef.current?.value||"0",num=Number(clearValue(current,precision,decimal).replace(decimal,"."))-step,newValue=Math.min(Math.max(num,minValue),maxValue),newValueStr=fitToCurrency(newValue.toFixed(precision),precision,decimal,thousand,fillEmptyDecimals);inputRef.current&&changeInputData(inputRef.current,{value:newValueStr})},handlePlus=()=>{const current=inputRef.current?.value||"0",num=Number(clearValue(current,precision,decimal).replace(decimal,"."))+step,newValue=Math.min(Math.max(num,minValue),maxValue),newValueStr=fitToCurrency(newValue.toFixed(precision),precision,decimal,thousand,fillEmptyDecimals);inputRef.current&&changeInputData(inputRef.current,{value:newValueStr})},iconArray=Children.toArray(iconsAfter||icons);!props.readOnly&&displayClearIcon&&innerValue&&iconArray.unshift(jsx(InputIconButton,{icon:SvgCloseOutline,onClick:()=>{inputRef.current&&changeInputData(inputRef.current,{value:""})},"aria-hidden":!0},"clear-icon")),!props.readOnly&&displayPlusMinusIcons&&iconArray.push(jsx(PlusMinusIcon,{icon:SvgMinusOutline,onClick:props.disabled||minusDisabled?void 0:handleMinus,disabled:props.disabled||minusDisabled,"aria-hidden":!0},"minus-icon"),jsx(PlusMinusIcon,{icon:SvgPlusOutline,onClick:props.disabled||plusDisabled?void 0:handlePlus,disabled:props.disabled||plusDisabled,"aria-hidden":!0},"plus-icon"));const iconCount=iconArray.length,handler=useMemo(()=>handleInput||createInputHandler({precision,decimal,thousand,minValue,maxValue}),[precision,decimal,thousand,minValue,maxValue,handleInput]);return jsxs(Wrapper,{ref:containerRef,className,style,disabled:props.disabled,$dimension:props.dimension,readOnly:props.readOnly,"data-read-only":!!props.readOnly||void 0,"data-disable-copying":!!disableCopying||void 0,onMouseDown:disableCopying?preventDefault:void 0,$skeleton:skeleton,$status:status,children:[jsx(Content,{$dimension:props.dimension,$iconsAfterCount:iconCount,onKeyDown:e=>{switch(keyboardKey.getCode(e)){case keyboardKey.ArrowUp:handlePlus(),e.preventDefault();break;case keyboardKey.ArrowDown:handleMinus(),e.preventDefault()}},children:jsx(AutoSizeInput,{ref:refSetter(ref,inputRef),onChange:event=>{setInnerValueState(event.currentTarget.value),onChange?.(event)},placeholder,onBlur:event=>{const newValue=fitToCurrency(event.target.value,precision,decimal,thousand,fillEmptyDecimals);inputRef.current&&newValue!==event.target.value&&changeInputData(inputRef.current,{value:newValue}),onBlur?.(event)},suffix,prefix,status,iconCount,align,innerValue,handleInput:handler,...props})}),iconCount>0&&jsx(IconPanel,{disabled:props.disabled,$dimension:props.dimension,children:iconArray})]})});NumberInput.displayName="NumberInput";export{NumberInput,clearValue,fitToCurrency};
//# sourceMappingURL=index.es.js.map
