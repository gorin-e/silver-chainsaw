import{jsx,jsxs,Fragment}from"react/jsx-runtime";import{forwardRef,useRef,useState,useEffect,useMemo}from"react";import{DropDownTree}from"./DropDownTree.es.js";import{refSetter}from"../../common/utils/refSetter.es.js";import{OpenStatusButton}from"../../OpenStatusButton.es.js";import{StyledMultiInput,StyledChip}from"./styled.es.js";import{checkboxTreeToMap}from"../../Menu/MenuItemWithCheckbox.es.js";const TreeSelect=forwardRef(({value,defaultValue,items,displayClearIcon,disabled,isLoading,readOnly,placeholder,dimension="m",openButtonPropsConfig,clearButtonPropsConfig,onOpenChange,onSelect,onDeselect,onChange,onClearIconClick},ref)=>{const inputRef=useRef(null),inputContainerRef=useRef(null),[open,setOpen]=useState(!1),[stateItems,setStateItems]=useState([...items]),[selectedChips,setSelectedChips]=useState([]);useEffect(()=>{const selected=(defaultValue??value??[]).map(item=>flatMap.get(item)?.node).filter(item=>!!item);selected.forEach(item=>item.checked=!0),setSelectedChips(selected)},[defaultValue,value]);const handleClickOutside=e=>{e.target&&inputContainerRef.current?.contains(e.target)||(setOpen(!1),onOpenChange?.(!1))},toggleOpen=()=>{setOpen(prevState=>{const newValue=!prevState;return onOpenChange?.(newValue),newValue})},handleClick=e=>{const element=e.target.closest("[data-role]");element instanceof HTMLElement&&("icon-pane-before"===element.dataset.role||"icon-pane-after"===element.dataset.role)||toggleOpen()},openButtonProps={$isOpen:open,"aria-hidden":!0,onClick:toggleOpen},iconsAfter=[];readOnly||iconsAfter.push(jsx(OpenStatusButton,{"data-disabled":!!disabled||void 0,"data-loading":!!isLoading||void 0,...openButtonProps,...openButtonPropsConfig?.(openButtonProps)}));const flatMap=useMemo(()=>checkboxTreeToMap(stateItems),[stateItems]),handleDeleteChip=id=>{if(id){handleDeselectItem(id);const newValue=selectedChips.filter(chip=>!!chip.checked).map(chip=>chip.id);onChange?.(newValue)}},selectItem=(items,item)=>{if(item.node.checked=!0,item.dependencies&&item.dependencies.length>0)item.dependencies?.forEach(depId=>{const depItem=flatMap.get(depId);depItem&&selectItem(items,depItem)});else{-1===selectedChips.findIndex(chip=>chip.id===item.node.id)&&items.push(item.node)}},handleDeselectItem=id=>{const item=flatMap.get(id);if(item){if(item.node.checked=!1,item.dependencies&&item.dependencies.length>0){const newSelectedChips=selectedChips.filter(chip=>!item.dependencies?.includes(chip.id));setSelectedChips(newSelectedChips)}else{const index=selectedChips.findIndex(chip=>chip.id===item.node.id);if(index>-1){const newSelectedChips=[...selectedChips];newSelectedChips.splice(index,1),setSelectedChips(newSelectedChips)}}onDeselect?.(id)}setStateItems([...stateItems])};return jsxs(Fragment,{children:[jsx(StyledMultiInput,{ref:refSetter(ref,inputRef),placeholder,containerPropsConfig:props=>({...props,ref:inputContainerRef,onClick:handleClick}),displayClearIcon:displayClearIcon&&selectedChips.length>0,iconsAfter,clearButtonPropsConfig,onClearOptions:()=>{setSelectedChips([]),flatMap.forEach(item=>item.node.checked=!1),setStateItems([...stateItems]),onClearIconClick?.(),onChange?.([])},dimension,children:selectedChips.map(item=>jsx(StyledChip,{id:item.id,onClick:e=>e.stopPropagation(),onClose:readOnly?void 0:handleDeleteChip,tabIndex:-1,dimension:"s",appearance:"filled",readOnly,disabled:item.disabled||disabled,children:item.label},item.id))}),open&&jsx(DropDownTree,{dropdownConfig:config=>({...config,onClickOutside:handleClickOutside,targetElement:inputContainerRef?.current}),items:flatMap,onSelectImem:id=>{const item=flatMap.get(id);if(item){const newSelectedChips=[...selectedChips];selectItem(newSelectedChips,item),setSelectedChips(newSelectedChips),setStateItems([...stateItems]),onSelect?.(id)}},onDeselectItem:handleDeselectItem,onChangeSelected:value=>{onChange?.(value)},dimension:"xl"===dimension?"l":dimension})]})});TreeSelect.displayName="TreeSelect";export{TreeSelect};
//# sourceMappingURL=index.es.js.map
