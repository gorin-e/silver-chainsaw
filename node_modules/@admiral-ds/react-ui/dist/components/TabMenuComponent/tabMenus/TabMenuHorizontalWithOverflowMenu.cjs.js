"use strict";var jsxRuntime=require("react/jsx-runtime"),e=require("react"),styled=require("styled-components"),checkOverflow=require("../../common/utils/checkOverflow.cjs.js"),debounce=require("../../common/utils/debounce.cjs.js"),ActiveHorizontalTabSelector=require("../containerElements/ActiveHorizontalTabSelector.cjs.js");require("../containerElements/ActiveVerticalTabSelector.cjs.js"),require("../containerElements/SlideArrowButton.cjs.js");var HorizontalTabOverflowMenu=require("../containerElements/HorizontalTabOverflowMenu.cjs.js");require("../containerElements/VerticalTabOverflowMenu.cjs.js");var HorizontalAddTabButton=require("../containerElements/HorizontalAddTabButton.cjs.js");require("../containerElements/VerticalAddTabButton.cjs.js");var HorizontalTabMenuContainer=require("../containers/HorizontalTabMenuContainer.cjs.js");require("../containers/IconTabMenuContainer.cjs.js"),require("../containers/HorizontalTabsContainer.cjs.js"),require("../containers/VerticalTabMenuContainer.cjs.js"),require("../containers/HorizontalCardTabMenuContainer.cjs.js");var constants=require("../constants.cjs.js"),utils=require("../utils.cjs.js");function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var styled__default=_interopDefault(styled);const HiddenContainer=styled__default.default.div`
  visibility: hidden;
  display: flex;
  flex-wrap: nowrap;
  box-sizing: border-box;
  overflow: hidden;
`,VisibleContainer=styled__default.default(HorizontalTabMenuContainer.HorizontalTabMenuContainer)`
  position: absolute;
  top: 0;
  left: 0;
`,Wrapper=styled__default.default.div`
  position: relative;
`,TabMenuHorizontalWithOverflowMenu=({dimension="l",appearance="primary",showUnderline,selectedTabId,defaultSelectedTabId,onSelectTab,onAddTab,tabsId,renderTab,renderDropMenuItem,tabIsDisabled,alignSelf,menuWidth,menuMaxHeight,dropContainerCssMixin,dropContainerClassName,dropContainerStyle,isVisible,onVisibilityChange,active,onActivateItem,disableSelectedOptionHighlight,renderTopPanel,renderBottomPanel,onForwardCycleApprove,onBackwardCycleApprove,onClickOutside,showActiveTabSelector,...props})=>{const dropProps={alignSelf,menuWidth,menuMaxHeight,dropContainerCssMixin,dropContainerClassName,dropContainerStyle,isVisible,onVisibilityChange,active,onActivateItem,disableSelectedOptionHighlight,renderTopPanel,renderBottomPanel,onForwardCycleApprove,onBackwardCycleApprove,onClickOutside},[containerWidth,setContainerWidth]=e.useState(0),visibleContainerRef=e.useRef(null),hiddenContainerRef=e.useRef(null),[overflowState,setOverflowState]=e.useState(!1);e.useLayoutEffect(()=>{if(visibleContainerRef.current){const resizeObserver=new ResizeObserver(entries=>{entries.forEach(entry=>setContainerWidth(entry.contentRect.width||0))});return resizeObserver.observe(visibleContainerRef.current),()=>{resizeObserver.disconnect()}}},[visibleContainerRef,dimension]);const showAddTabButton=!!onAddTab,[selectedTabInner,setSelectedTabInner]=e.useState(defaultSelectedTabId),selectedTab=selectedTabId||selectedTabInner,handleSelectTab=tabId=>{tabIsDisabled(tabId)||(setSelectedTabInner(tabId),onSelectTab?.(tabId))},horizontalTabs=e.useMemo(()=>tabsId.map(tabId=>renderTab(tabId,tabId===selectedTab,void 0)),[tabsId,renderTab]),[visibleTabs,setVisibleTabs]=e.useState([]),[hiddenTabs,setHiddenTabs]=e.useState([]),[tabWidthMap,setTabWidthMap]=e.useState([]);e.useEffect(()=>{const setTabWidth=()=>{if(hiddenContainerRef.current){const overflow=checkOverflow.checkOverflow(hiddenContainerRef.current);overflowState!==overflow&&setOverflowState(overflow);const tabWidth=utils.getTabWidthMap(tabsId,hiddenContainerRef.current.children);setTabWidthMap(tabWidth)}};if(hiddenContainerRef.current?.firstElementChild){const resizeObserver=new ResizeObserver(debounce.debounce(setTabWidth,100));return resizeObserver.observe(hiddenContainerRef.current?.firstElementChild),()=>{resizeObserver.disconnect()}}},[hiddenContainerRef,containerWidth,horizontalTabs,tabsId]),e.useEffect(()=>{const newVisibleTabs=[],newHiddenTabs=[];if(visibleContainerRef.current&&tabWidthMap.length>0){const maxWidth=containerWidth,addToVisible=tabId=>newVisibleTabs.push(tabId),addToHidden=tabId=>newHiddenTabs.push(tabId),activeTabWidth=tabWidthMap.find(tab=>tab.tabId===selectedTab)?.width||0;let availableWidth=maxWidth-(overflowState?("l"===dimension?constants.OVERFLOW_MENU_CONTAINER_SIZE_L:constants.OVERFLOW_MENU_CONTAINER_SIZE_M)+activeTabWidth:0)-(showAddTabButton?"l"===dimension?constants.ADD_TAB_BUTTON_CONTAINER_SIZE_L:constants.ADD_TAB_BUTTON_CONTAINER_SIZE_M:0);tabWidthMap.forEach(({tabId,width})=>{const tabIsActive=tabId===selectedTab,tabWidth=width;(availableWidth>=tabWidth||tabIsActive)&&addToVisible(tabId),(0===availableWidth||availableWidth<tabWidth&&!tabIsActive)&&addToHidden(tabId),availableWidth>0&&(tabIsActive||(availableWidth>=tabWidth?availableWidth-=tabWidth:availableWidth=0))})}setVisibleTabs(newVisibleTabs),setHiddenTabs(newHiddenTabs)},[visibleContainerRef,containerWidth,tabWidthMap,overflowState,showAddTabButton,selectedTab]);const renderedVisibleTabs=visibleTabs.map(tabId=>renderTab(tabId,tabId===selectedTab,handleSelectTab)),overflowMenuItems=e.useMemo(()=>0===hiddenTabs.length?[]:hiddenTabs.map(tabId=>({id:tabId,render:renderDropMenuItem(tabId),disabled:tabIsDisabled(tabId)})),[hiddenTabs,dimension]),[underlineLeft,setUnderlineLeft]=e.useState(0),[underlineWidth,setUnderlineWidth]=e.useState(0),getUnderlinePosition=()=>{const width=selectedTab?utils.getActiveTabWidth(tabWidthMap,selectedTab):0;return{left:(()=>{const index=visibleTabs.findIndex(tab=>tab===selectedTab);if(index<0)return 0;let left=0;for(let i=0;i<index;i++)left+=tabWidthMap.find(tab=>tab.tabId===visibleTabs[i])?.width||0;return left})(),width}};return e.useEffect(()=>{showActiveTabSelector&&(()=>{const{left,width}=getUnderlinePosition();setUnderlineWidth(width),setUnderlineLeft(left)})()},[selectedTab,renderedVisibleTabs]),jsxRuntime.jsxs(Wrapper,{...props,children:[jsxRuntime.jsx(HiddenContainer,{ref:hiddenContainerRef,children:horizontalTabs}),jsxRuntime.jsxs(VisibleContainer,{ref:visibleContainerRef,$showUnderline:showUnderline,children:[renderedVisibleTabs,showAddTabButton&&jsxRuntime.jsx(HorizontalAddTabButton.HorizontalAddTabButton,{dimension,onClick:onAddTab}),jsxRuntime.jsx(HorizontalTabOverflowMenu.HorizontalTabOverflowMenu,{...dropProps,items:overflowMenuItems,isHidden:!overflowState,onSelectItem:handleSelectTab,selected:selectedTab,dimension}),showActiveTabSelector&&jsxRuntime.jsx(ActiveHorizontalTabSelector.ActiveHorizontalTabSelector,{$appearance:appearance,$left:`${underlineLeft}px`,$width:`${underlineWidth}px`,$transition:!0})]})]})};TabMenuHorizontalWithOverflowMenu.displayName="TabMenuHorizontalWithOverflowMenu",exports.TabMenuHorizontalWithOverflowMenu=TabMenuHorizontalWithOverflowMenu;
//# sourceMappingURL=TabMenuHorizontalWithOverflowMenu.cjs.js.map
